import{a as S}from"./chunk-PLFLKSHQ.js";import{a as m}from"./chunk-YP3E4DFS.js";import{b as f}from"./chunk-Y5E3HJHA.js";import{Cc as u,a as d,b as l,ca as r,fa as g,ka as n,ob as h}from"./chunk-G6VS4OII.js";var I=(()=>{let e=class e{constructor(t,i,s){this.http=t,this.stationsService=i,this.carriagesService=s,this.baseRoutes=h([]),this.carriages=this.carriagesService.carriages,this.stations=this.stationsService.stations,this.stationsMap=this.stationsService.stationsMap,this.routes=u(()=>this.baseRoutes().map(a=>l(d({},a),{cities:a.path.map(o=>this.stationsMap()[o]?.city||"")}))),this.isLoadingRoutes=h(!1),this.isLoadingStations=h(!1),this.isLoading=u(()=>this.isLoadingRoutes()||this.isLoadingStations()),this.loadData()}loadData(){this.loadRoutes(),this.loadStations(),this.loadCarriages()}loadRoutes(){this.isLoadingRoutes.set(!0),this.http.get("/api/route").subscribe(t=>{this.baseRoutes.set(t),this.isLoadingRoutes.set(!1)})}loadStations(){this.isLoadingStations.set(!0),this.stationsService.getStations().subscribe(()=>{this.isLoadingStations.set(!1)})}loadCarriages(){this.carriagesService.getCarriages().subscribe()}deleteRoute(t){return this.http.delete(`/api/route/${t}`).pipe(r(()=>{this.baseRoutes.update(i=>i.filter(s=>s.id!==t))}))}createRoute(t,i){return this.http.post("/api/route",{path:t,carriages:i}).pipe(r(({id:s})=>{this.baseRoutes.update(a=>[...a,{id:s,path:t,carriages:i}])}))}updateRoute(t,i,s){return this.http.put(`/api/route/${t}`,{path:i,carriages:s}).pipe(r(({id:a})=>{this.baseRoutes.update(c=>c.map(o=>o.id===a?{id:a,path:i,carriages:s}:o))}))}};e.\u0275fac=function(i){return new(i||e)(n(f),n(m),n(S))},e.\u0275prov=g({token:e,factory:e.\u0275fac,providedIn:"root"});let p=e;return p})();export{I as a};
