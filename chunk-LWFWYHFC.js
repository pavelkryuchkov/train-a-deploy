import{a as m}from"./chunk-CFKXUS52.js";import{l as f}from"./chunk-OCTEUITK.js";import{Ac as u,a as d,b as l,ba as r,ea as g,ja as p,mb as o}from"./chunk-BUUJEY2M.js";var y=(()=>{let e=class e{constructor(t,s){this.http=t,this.stationsService=s,this.baseRoutes=o([]),this.carriages=o([]),this.stations=this.stationsService.stations,this.stationsMap=this.stationsService.stationsMap,this.routes=u(()=>this.baseRoutes().map(i=>l(d({},i),{cities:i.path.map(h=>this.stationsMap()[h]?.city||"")}))),this.isLoadingRoutes=o(!1),this.isLoadingStations=o(!1),this.isLoading=u(()=>this.isLoadingRoutes()||this.isLoadingStations()),this.loadData()}loadData(){this.loadRoutes(),this.loadStations(),this.loadCarriages()}loadRoutes(){this.isLoadingRoutes.set(!0),this.http.get("/api/route").subscribe(t=>{this.baseRoutes.set(t),this.isLoadingRoutes.set(!1)})}loadStations(){this.isLoadingStations.set(!0),this.stationsService.getStations().subscribe(()=>{this.isLoadingStations.set(!1)})}loadCarriages(){this.http.get("/api/carriage").subscribe(t=>this.carriages.set(t))}deleteRoute(t){return this.http.delete(`/api/route/${t}`).pipe(r(()=>{this.baseRoutes.update(s=>s.filter(i=>i.id!==t))}))}createRoute(t,s){return this.http.post("/api/route",{path:t,carriages:s}).pipe(r(({id:i})=>{this.baseRoutes.update(a=>[...a,{id:i,path:t,carriages:s}])}))}updateRoute(t,s,i){return this.http.put(`/api/route/${t}`,{path:s,carriages:i}).pipe(r(({id:a})=>{this.baseRoutes.update(h=>h.map(c=>c.id===a?{id:a,path:s,carriages:i}:c))}))}};e.\u0275fac=function(s){return new(s||e)(p(f),p(m))},e.\u0275prov=g({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{y as a};
