import{a as L}from"./chunk-CGT3BUGO.js";import{a as v}from"./chunk-PWD6J7HC.js";import{a as R}from"./chunk-FDT3V673.js";import{b}from"./chunk-Y5E3HJHA.js";import{$ as c,Cc as l,K as h,a as m,b as S,ca as p,fa as f,ka as r,ob as u,u as n}from"./chunk-G6VS4OII.js";var x=(()=>{let e=class e{constructor(s,t,i,a){this.http=s,this.stationsService=t,this.carriagesService=i,this.snackbar=a,this.baseRoutes=u([]),this.carriages=this.carriagesService.carriages,this.carriagesMap=this.carriagesService.carriagesMap,this.stations=this.stationsService.stations,this.stationsMap=this.stationsService.stationsMap,this.routes=l(()=>this.baseRoutes().map(d=>S(m({},d),{cities:d.path.map(o=>this.stationsMap()[o]?.city||""),carriageNames:d.carriages.map(o=>this.carriagesMap()[o]?.name||o)}))),this.isLoadingRoutes=u(!1),this.isLoadingStations=u(!1),this.isLoading=l(()=>this.isLoadingRoutes()||this.isLoadingStations()),this.loadData()}loadData(){this.loadRoutes(),this.loadStations(),this.loadCarriages()}loadRoutes(){this.isLoadingRoutes.set(!0),this.http.get("/api/route").subscribe(s=>{this.baseRoutes.set(s),this.isLoadingRoutes.set(!1)})}loadStations(){this.isLoadingStations.set(!0),this.stationsService.getStations().subscribe(()=>{this.isLoadingStations.set(!1)})}loadCarriages(){this.carriagesService.getCarriages().subscribe()}deleteRoute(s){return this.http.delete(`/api/route/${s}`).pipe(h(t=>(this.snackbar.open(t.error.message,"close",{duration:2e3}),n({error:t}))),c(()=>this.http.get("/api/route")),p(t=>this.baseRoutes.set(t)))}createRoute(s,t){return this.http.post("/api/route",{path:s,carriages:t}).pipe(h(i=>(this.snackbar.open(i.error.message,"close",{duration:2e3}),n({error:i}))),c(()=>this.http.get("/api/route")),p(i=>this.baseRoutes.set(i)))}updateRoute(s,t,i){return this.http.put(`/api/route/${s}`,{path:t,carriages:i}).pipe(h(a=>(this.snackbar.open(a.error.message,"close",{duration:2e3}),n({error:a}))),c(()=>this.http.get("/api/route")),p(a=>this.baseRoutes.set(a)))}};e.\u0275fac=function(t){return new(t||e)(r(b),r(v),r(L),r(R))},e.\u0275prov=f({token:e,factory:e.\u0275fac,providedIn:"root"});let g=e;return g})();export{x as a};
