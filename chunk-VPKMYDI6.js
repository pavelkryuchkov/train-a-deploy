import{a as gt,c as Ct}from"./chunk-XMOYIX4R.js";import{a as ft}from"./chunk-3IRY7LW3.js";import{a as R}from"./chunk-6IDCPCIY.js";import{a as rt,g as at}from"./chunk-6S6244GH.js";import{f as J,g as K,i as X,l as Y,m as Z,n as tt,s as et,u as it}from"./chunk-A73FDB7P.js";import{a as st,b as ct}from"./chunk-EXM2XI3D.js";import"./chunk-PLFLKSHQ.js";import"./chunk-YP3E4DFS.js";import{a as mt,b as lt,c as pt,d as dt,f as ut}from"./chunk-HAJTOM24.js";import{a as $,b as N}from"./chunk-WCVEZFQA.js";import{c as _t}from"./chunk-57V65NWP.js";import"./chunk-Z6QEANO5.js";import{a as w,b as ot,d as P}from"./chunk-4PPTANTY.js";import"./chunk-5POHLGBV.js";import{a as Q,c as W,d as H}from"./chunk-YNWXQWJD.js";import"./chunk-QDL5SYJ2.js";import"./chunk-3X4PWRWX.js";import{V as nt}from"./chunk-IP76CWZZ.js";import"./chunk-Y5E3HJHA.js";import{$b as m,Cb as g,Cc as O,Db as V,Eb as B,Ec as z,Fa as T,Fb as C,Gb as f,Hb as a,Ib as r,Ja as k,Jb as E,Lb as F,Ob as d,Qb as l,Tb as A,Vb as L,Wb as j,Xb as G,ac as y,bb as c,bc as I,cb as S,ic as b,jc as q,kc as U,ob as v,pa as M,vb as _,wa as D,xa as h,xb as u,ya as x}from"./chunk-G6VS4OII.js";var vt=(t,i)=>i.id,wt=(t,i)=>i.name;function Pt(t,i){if(t&1&&(a(0,"mat-option",12),m(1),r()),t&2){let e=i.$implicit;A("value",e.id),c(),y(e.city)}}function Rt(t,i){if(t&1&&C(0,Pt,2,2,"mat-option",12,vt),t&2){let e=l(3);f(e.routesService.stations())}}function Ot(t,i){if(t&1&&(a(0,"mat-option",12),m(1),r()),t&2){let e=i.$implicit;A("value",e.id),c(),y(e.city)}}function Tt(t,i){if(t&1&&C(0,Ot,2,2,"mat-option",12,vt),t&2){let e=l().$index,n=l(2);f(n.cityOptions()[e-1])}}function Et(t,i){if(t&1){let e=F();a(0,"div",4)(1,"mat-form-field",10)(2,"mat-label"),m(3,"Select station"),r(),a(4,"mat-select",11),d("selectionChange",function(){let o=h(e).$index,s=l(2);return x(s.addNewStation(o))}),_(5,Rt,2,0)(6,Tt,2,0),r()()()}if(t&2){let e=i.$index;c(4),u("formControlName",e),c(),g(e===0?5:6)}}function At(t,i){if(t&1&&(a(0,"mat-option",12),m(1),r()),t&2){let e=i.$implicit;A("value",e.name),c(),y(e.name)}}function It(t,i){if(t&1){let e=F();a(0,"div",5)(1,"mat-form-field",10)(2,"mat-label"),m(3,"Select carriage"),r(),a(4,"mat-select",11),d("selectionChange",function(){let o=h(e).$index,s=l(2);return x(s.addNewCarriage(o))}),C(5,At,2,2,"mat-option",12,wt),r()()()}if(t&2){let e=i.$index,n=l(2);c(4),u("formControlName",e),c(),f(n.routesService.carriages())}}function zt(t,i){t&1&&E(0,"mat-spinner",8)}function $t(t,i){if(t&1&&(a(0,"button",9),m(1,"Save route"),r()),t&2){let e=l(2);u("disabled",e.isSubmitDisabled())}}function Nt(t,i){if(t&1){let e=F();a(0,"form",1),d("ngSubmit",function(){h(e);let o=l();return x(o.onSubmit())}),a(1,"div",2)(2,"div",3)(3,"h4"),m(4,"Stations"),r(),C(5,Et,7,2,"div",4,B),r(),a(7,"div",3)(8,"h4"),m(9,"Carriages"),r(),C(10,It,7,1,"div",5,B),r()(),a(12,"div",6)(13,"button",7),d("click",function(){h(e);let o=l();return x(o.onCancel())}),m(14,"Cancel"),r(),_(15,zt,1,0,"mat-spinner",8)(16,$t,2,1,"button",9),r()()}if(t&2){let e=l();u("formGroup",e.form),c(5),f(e.stationsFormArray.controls),c(5),f(e.carriagesFormArray.controls),c(3),u("disabled",e.isLoading()),c(2),g(e.isLoading()?15:16)}}var Vt=3,Bt=3,Ft=(()=>{let i=class i{constructor(n,o){this.formBuilder=n,this.routesService=o,this.route=null,this.closeForm=new T,this.selectedCities=v([]),this.selectedCarriages=v([]),this.cityOptions=O(()=>this.selectedCities().map(s=>this.routesService.stationsMap()[s].connectedTo?.map(p=>this.routesService.stationsMap()[p.id])||[])),this.isSubmitDisabled=O(()=>this.selectedCities().length<Vt||this.selectedCarriages().length<Bt),this.isLoading=v(!1),this.form=this.formBuilder.group({selectStation:this.formBuilder.array([this.formBuilder.control("")]),selectCarriage:this.formBuilder.array([this.formBuilder.control("")])}),z(()=>{let s=this.routesService.routes();this.route&&!s.map(p=>p.id).includes(this.route.id)&&this.closeForm.emit()})}ngOnChanges(){this.route&&(this.selectedCities.set(this.route.path),this.selectedCarriages.set(this.route.carriages),this.stationsFormArray.clear(),this.selectedCities().forEach(n=>this.stationsFormArray.push(this.formBuilder.control(n.toString()))),this.stationsFormArray.push(this.formBuilder.control("")),this.carriagesFormArray.clear(),this.selectedCarriages().forEach(n=>this.carriagesFormArray.push(this.formBuilder.control(n))),this.carriagesFormArray.push(this.formBuilder.control("")))}get stationsFormArray(){return this.form.controls.selectStation}get carriagesFormArray(){return this.form.controls.selectCarriage}addNewStation(n){if(n<this.stationsFormArray.controls.length-1)for(let o=this.stationsFormArray.length-1;o>n;o-=1)this.stationsFormArray.removeAt(o);this.stationsFormArray.push(this.formBuilder.control("")),this.selectedCities.set(this.stationsFormArray.value.slice(0,-1).map(o=>Number(o)))}addNewCarriage(n){if(n<this.carriagesFormArray.controls.length-1)for(let o=this.carriagesFormArray.length-1;o>n;o-=1)this.carriagesFormArray.removeAt(o);this.carriagesFormArray.push(this.formBuilder.control("")),this.selectedCarriages.set(this.carriagesFormArray.value.slice(0,-1))}onSubmit(){if(this.isSubmitDisabled())return;this.isLoading.set(!0);let n=this.selectedCities(),o=this.selectedCarriages();if(this.route){this.routesService.updateRoute(this.route.id,n,o).subscribe(()=>{this.isLoading.set(!1),this.closeForm.emit()});return}this.routesService.createRoute(n,o).subscribe(()=>{this.isLoading.set(!1),this.closeForm.emit()})}onCancel(){this.closeForm.emit()}};i.\u0275fac=function(o){return new(o||i)(S(et),S(R))},i.\u0275cmp=M({type:i,selectors:[["app-create-route-form"]],inputs:{route:"route"},outputs:{closeForm:"closeForm"},standalone:!0,features:[D,b],decls:1,vars:1,consts:[[1,"form",3,"formGroup"],[1,"form",3,"ngSubmit","formGroup"],[1,"wrapper"],[1,"form-wrapper"],["formArrayName","selectStation"],["formArrayName","selectCarriage"],[1,"buttons-wrapper"],["mat-button","","type","button",1,"button",3,"click","disabled"],["diameter","40"],["mat-flat-button","","type","submit",1,"button",3,"disabled"],["appearance","outline",1,"dense-5","form-field"],[3,"selectionChange","formControlName"],[3,"value"]],template:function(o,s){o&1&&_(0,Nt,17,3,"form",0),o&2&&g(s.form?0:-1)},dependencies:[at,rt,gt,nt,P,w,N,$,it,X,J,K,Y,tt,Z],styles:["[_nghost-%COMP%]{width:100%}.form[_ngcontent-%COMP%], .form-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:start;align-items:center;width:100%}.form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .form-wrapper[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{align-self:start}.form-wrapper[_ngcontent-%COMP%]{align-items:stretch;min-width:0}.wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:30px;width:100%;max-width:830px}@media (max-width: 560px){.wrapper[_ngcontent-%COMP%]{gap:10px}}.buttons-wrapper[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.button[_ngcontent-%COMP%]{width:auto;font-size:18px}  .mat-mdc-text-field-wrapper{background-color:var(--mdc-outlined-card-container-color)!important}.form-field[_ngcontent-%COMP%]{width:100%;height:50px}"],changeDetection:0});let t=i;return t})();var Dt=t=>["/admin/routes",t],kt=()=>({fromRoutesPage:!0});function Lt(t,i){if(t&1&&(a(0,"strong"),m(1),r()),t&2){let e=l().$implicit;c(),I("",e,"\xA0\xA0\u0336\xA0 ")}}function jt(t,i){if(t&1&&(a(0,"strong"),m(1),r()),t&2){let e=l().$implicit;c(),y(e)}}function Gt(t,i){if(t&1&&(a(0,"span"),_(1,Lt,2,1,"strong")(2,jt,2,1,"strong"),r()),t&2){let e=i.$index,n=i.$count;c(),g(e!==n-1?1:2)}}function qt(t,i){if(t&1&&(a(0,"strong"),m(1),r()),t&2){let e=l().$implicit;c(),I("",e,"\xA0\xA0\u0336\xA0 ")}}function Ut(t,i){if(t&1&&(a(0,"strong"),m(1),r()),t&2){let e=l().$implicit;c(),y(e)}}function Qt(t,i){if(t&1&&(a(0,"span"),_(1,qt,2,1,"strong")(2,Ut,2,1,"strong"),r()),t&2){let e=i.$index,n=i.$count;c(),g(e!==n-1?1:2)}}var yt=(()=>{let i=class i{constructor(n,o){this.routesService=n,this.dialog=o,this.update=new T}openDialog(){this.dialog.open(ft,{data:{heading:"Delete ride",content:"Would you like to delete this ride?",onDelete:()=>this.routesService.deleteRoute(this.route.id)},width:"250px",enterAnimationDuration:0,exitAnimationDuration:0})}onUpdate(){this.update.emit(this.route)}};i.\u0275fac=function(o){return new(o||i)(S(R),S(_t))},i.\u0275cmp=M({type:i,selectors:[["app-route-card"]],inputs:{route:"route"},outputs:{update:"update"},standalone:!0,features:[b],decls:26,vars:6,consts:[["appearance","outlined"],[1,"buttons-wrapper"],["mat-button","",1,"card-button",3,"click"],["mat-button","","aria-label","button",1,"card-button",3,"routerLink","state"],[1,"delete-icon"]],template:function(o,s){o&1&&(a(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),m(3),r(),a(4,"div",1)(5,"button",2),d("click",function(){return s.onUpdate()}),m(6," Update "),a(7,"mat-icon"),m(8,"edit"),r()(),a(9,"a",3)(10,"mat-icon"),m(11,"train"),r(),m(12," Assign\xA0ride "),r(),a(13,"button",2),d("click",function(){return s.openDialog()}),a(14,"mat-icon",4),m(15,"delete"),r()()()(),a(16,"mat-card-subtitle"),m(17,"Cities:"),r(),a(18,"mat-card-content"),C(19,Gt,3,1,"span",null,V),r(),a(21,"mat-card-subtitle"),m(22,"Carriage Types:"),r(),a(23,"mat-card-content"),C(24,Qt,3,1,"span",null,V),r()()),o&2&&(c(3),I("Route ",s.route.id,""),c(6),u("routerLink",U(3,Dt,s.route.id))("state",q(5,kt)),c(10),f(s.route.cities),c(5),f(s.route.carriages))},dependencies:[mt,ut,lt,pt,dt,ct,st,P,ot,w,H],styles:["[_nghost-%COMP%]{width:100%}.mat-mdc-card-content[_ngcontent-%COMP%]{padding:10px 16px}.mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px;align-items:center;justify-content:space-between}.mat-mdc-card-subtitle[_ngcontent-%COMP%]{padding-left:16px}.buttons-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.card-button[_ngcontent-%COMP%]{padding:10px;border:none;background-color:inherit;font-size:16px;color:#000}.card-button[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:20px}.delete-icon[_ngcontent-%COMP%]{margin:0}@media (max-width: 570px){.mat-mdc-card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:start;gap:10px}.buttons-wrapper[_ngcontent-%COMP%]{align-self:center}}@media (max-width: 450px){.mat-mdc-card-content[_ngcontent-%COMP%], .mat-mdc-card-header[_ngcontent-%COMP%]{padding:10px}.mat-mdc-card-subtitle[_ngcontent-%COMP%]{padding-left:10px}.card-button[_ngcontent-%COMP%]{font-size:14px}.card-button[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:18px}}"],changeDetection:0});let t=i;return t})();var Wt=["form"],Ht=(t,i)=>i.id;function Jt(t,i){t&1&&E(0,"mat-spinner",2)}function Kt(t,i){if(t&1){let e=F();a(0,"app-create-route-form",6,0),d("closeForm",function(){h(e);let o=l(2);return x(o.onCloseForm())}),r()}if(t&2){let e=l(2);u("route",e.selectedRoute())}}function Xt(t,i){if(t&1){let e=F();a(0,"button",7),d("click",function(){h(e);let o=l(2);return x(o.showCreateForm())}),m(1,"Create"),r()}}function Yt(t,i){if(t&1){let e=F();a(0,"app-route-card",8),d("update",function(o){h(e);let s=l(2);return x(s.onUpdate(o))}),r()}if(t&2){let e=i.$implicit;u("route",e)}}function Zt(t,i){if(t&1){let e=F();a(0,"mat-paginator",9),d("page",function(o){h(e);let s=l(2);return x(s.onPageChange(o))}),r()}if(t&2){let e=l(2);u("pageIndex",e.currentPage())("length",i)("pageSize",e.pageSize())("pageSizeOptions",e.pageSizes)}}function te(t,i){if(t&1&&(_(0,Kt,2,1,"app-create-route-form",3)(1,Xt,2,0,"button",4),C(2,Yt,1,1,"app-route-card",3,Ht),_(4,Zt,1,4,"mat-paginator",5)),t&2){let e,n=l();g(n.isFormOpen()?0:1),c(2),f(n.paginatorRoutes()),c(2),g((e=n.routesService.routes().length)?4:-1,e)}}var Ne=(()=>{let i=class i{set form(n){n&&(this.formRef=n),n&&this.selectedRoute()&&n.nativeElement.scrollIntoView(!0)}constructor(n,o,s){this.routesService=n,this.router=o,this.activatedRoute=s,this.formRef=null,this.initialPageSize=10,this.pageSizes=[5,10,15],this.currentPage=v(0),this.pageSize=v(this.initialPageSize),this.isFormOpen=v(!1),this.selectedRoute=v(null),this.paginatorRoutes=O(()=>{let p=this.currentPage()*this.pageSize(),Mt=p+this.pageSize();return this.routesService.routes().slice(p,Mt)}),z(()=>{this.paginatorRoutes().length===0&&this.currentPage()>0&&this.currentPage.update(p=>p-1)},{allowSignalWrites:!0})}ngOnInit(){let n=Number(this.activatedRoute.snapshot.queryParamMap.get("page"))||0,o=Number(this.activatedRoute.snapshot.queryParamMap.get("size"))||this.initialPageSize;this.currentPage.set(n),this.pageSize.set(o),this.activatedRoute.queryParamMap.subscribe(s=>{s.has("page")&&this.currentPage.set(Number(s.get("page"))),s.has("size")&&this.pageSize.set(Number(s.get("size")))})}onPageChange(n){this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:{page:n.pageIndex,size:n.pageSize}})}showCreateForm(){this.isFormOpen.set(!0)}onCloseForm(){this.selectedRoute.set(null),this.isFormOpen.set(!1)}onUpdate(n){this.selectedRoute.set(n),this.isFormOpen.set(!0),this.formRef?.nativeElement.scrollIntoView(!0)}};i.\u0275fac=function(o){return new(o||i)(S(R),S(W),S(Q))},i.\u0275cmp=M({type:i,selectors:[["app-routes-page"]],viewQuery:function(o,s){if(o&1&&L(Wt,5,k),o&2){let p;j(p=G())&&(s.form=p.first)}},standalone:!0,features:[b],decls:3,vars:1,consts:[["form",""],[1,"wrapper"],[1,"spinner"],[3,"route"],["mat-flat-button","",1,"create-button"],["showFirstLastButtons","true",1,"paginator",3,"pageIndex","length","pageSize","pageSizeOptions"],[3,"closeForm","route"],["mat-flat-button","",1,"create-button",3,"click"],[3,"update","route"],["showFirstLastButtons","true",1,"paginator",3,"page","pageIndex","length","pageSize","pageSizeOptions"]],template:function(o,s){o&1&&(a(0,"main",1),_(1,Jt,1,0,"mat-spinner",2)(2,te,5,2),r()),o&2&&(c(),g(s.routesService.isLoading()?1:2))},dependencies:[yt,Ct,P,w,N,$,Ft],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:90%;max-width:1300px;margin:20px auto}.create-button[_ngcontent-%COMP%]{align-self:start;font-size:18px}.paginator[_ngcontent-%COMP%]{margin-bottom:20px;font-size:16px}@media (max-width: 450px){.paginator[_ngcontent-%COMP%]{font-size:14px}}.spinner[_ngcontent-%COMP%]{margin:50px}"],changeDetection:0});let t=i;return t})();export{Ne as RoutesPageComponent};
