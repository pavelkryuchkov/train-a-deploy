import{a as wt}from"./chunk-UQWQDUAI.js";import{c as yt}from"./chunk-7NDOFM3A.js";import{a as it,c as nt,d as ot}from"./chunk-5KWTDDC5.js";import{a as Mt,c as Rt}from"./chunk-SSVOS3PN.js";import{a as xt,b as St,c as vt,d as Ft,f as bt}from"./chunk-24JWDZRU.js";import{a as N,b as D}from"./chunk-BN6COBRA.js";import{a as gt,g as ft}from"./chunk-7KAPIAJA.js";import{d as rt,e as at,g as st,j as ct,k as lt,l as mt,p as pt,r as ut,s as w,t as _t,v as P,w as ht,x as Ct}from"./chunk-ILAPDML3.js";import"./chunk-376MERAZ.js";import"./chunk-2VT33OMA.js";import{K as dt}from"./chunk-TUFASTQV.js";import{j as et}from"./chunk-XNQEGZ6G.js";import{$ as T,$b as tt,Ab as C,Ba as E,Bb as s,Cb as a,Db as I,Ea as J,Fb as F,Jb as d,Kb as m,Nb as A,Pb as K,Qb as X,Rb as Y,Vb as l,Wb as y,Xb as z,Ya as c,Za as v,Zb as R,_b as Z,a as q,b as U,ca as Q,ha as H,ib as u,ka as M,pb as g,qc as b,rb as _,sa as W,sc as $,ta as x,ua as S,wb as f,xb as k,yb as B,zb as h}from"./chunk-743WUKBY.js";var O=(()=>{let n=class n{constructor(e){this.http=e,this.baseRoutes=u([]),this.stations=u([]),this.carriages=u([]),this.stationsMap=b(()=>{let i={};return this.stations().forEach(r=>{i[r.id]=r}),i}),this.routes=b(()=>this.baseRoutes().map(i=>U(q({},i),{cities:i.path.map(p=>this.stationsMap()[p]?.city||"")}))),this.isLoadingRoutes=u(!1),this.isLoadingStations=u(!1),this.isLoading=b(()=>this.isLoadingRoutes()||this.isLoadingStations()),this.loadData()}loadData(){this.loadRoutes(),this.loadStations(),this.loadCarriages()}loadRoutes(){this.isLoadingRoutes.set(!0),this.http.get("/api/route").subscribe(e=>{this.baseRoutes.set(e),this.isLoadingRoutes.set(!1)})}loadStations(){this.isLoadingStations.set(!0),this.http.get("/api/station").subscribe(e=>{this.stations.set(e),this.isLoadingStations.set(!1)})}loadCarriages(){this.http.get("/api/carriage").subscribe(e=>this.carriages.set(e))}deleteRoute(e){return this.http.delete(`/api/route/${e}`).pipe(T(()=>{this.baseRoutes.update(i=>i.filter(r=>r.id!==e))}))}createRoute(e,i){return this.http.post("/api/route",{path:e,carriages:i}).pipe(T(({id:r})=>{this.baseRoutes.update(p=>[...p,{id:r,path:e,carriages:i}])}))}updateRoute(e,i,r){return this.http.put(`/api/route/${e}`,{path:i,carriages:r}).pipe(T(({id:p})=>{this.baseRoutes.update(V=>V.map(G=>G.id===p?{id:p,path:i,carriages:r}:G))}))}};n.\u0275fac=function(i){return new(i||n)(H(et))},n.\u0275prov=Q({token:n,factory:n.\u0275fac,providedIn:"root"});let t=n;return t})();var Ot=(t,n)=>n.id,At=(t,n)=>n.name;function zt(t,n){if(t&1&&(s(0,"mat-option",12),l(1),a()),t&2){let o=n.$implicit;A("value",o.id),c(),y(o.city)}}function $t(t,n){if(t&1&&h(0,zt,2,2,"mat-option",12,Ot),t&2){let o=m(3);C(o.routesService.stations())}}function Nt(t,n){if(t&1&&(s(0,"mat-option",12),l(1),a()),t&2){let o=n.$implicit;A("value",o.id),c(),y(o.city)}}function Dt(t,n){if(t&1&&h(0,Nt,2,2,"mat-option",12,Ot),t&2){let o=m().$index,e=m(2);C(e.cityOptions()[o-1])}}function Vt(t,n){if(t&1){let o=F();s(0,"div",4)(1,"mat-form-field",10)(2,"mat-label"),l(3,"Select station"),a(),s(4,"mat-select",11),d("selectionChange",function(){let i=x(o).$index,r=m(2);return S(r.addNewStation(i))}),g(5,$t,2,0)(6,Dt,2,0),a()()()}if(t&2){let o=n.$index;c(4),_("formControlName",o),c(),f(o===0?5:6)}}function kt(t,n){if(t&1&&(s(0,"mat-option",12),l(1),a()),t&2){let o=n.$implicit;A("value",o.name),c(),y(o.name)}}function Bt(t,n){if(t&1){let o=F();s(0,"div",5)(1,"mat-form-field",10)(2,"mat-label"),l(3,"Select carriage"),a(),s(4,"mat-select",11),d("selectionChange",function(){let i=x(o).$index,r=m(2);return S(r.addNewCarriage(i))}),h(5,kt,2,2,"mat-option",12,At),a()()()}if(t&2){let o=n.$index,e=m(2);c(4),_("formControlName",o),c(),C(e.routesService.carriages())}}function Lt(t,n){t&1&&I(0,"mat-spinner",8)}function jt(t,n){if(t&1&&(s(0,"button",9),l(1,"Save route"),a()),t&2){let o=m(2);_("disabled",o.isSubmitDisabled())}}function Gt(t,n){if(t&1){let o=F();s(0,"form",1),d("ngSubmit",function(){x(o);let i=m();return S(i.onSubmit())}),s(1,"div",2)(2,"div",3)(3,"h4"),l(4,"Stations"),a(),h(5,Vt,7,2,"div",4,B),a(),s(7,"div",3)(8,"h4"),l(9,"Carriages"),a(),h(10,Bt,7,1,"div",5,B),a()(),s(12,"div",6)(13,"button",7),d("click",function(){x(o);let i=m();return S(i.onCancel())}),l(14,"Cancel"),a(),g(15,Lt,1,0,"mat-spinner",8)(16,jt,2,1,"button",9),a()()}if(t&2){let o=m();_("formGroup",o.form),c(5),C(o.stationsFormArray.controls),c(5),C(o.carriagesFormArray.controls),c(3),_("disabled",o.isLoading()),c(2),f(o.isLoading()?15:16)}}var qt=3,Ut=3,Tt=(()=>{let n=class n{constructor(e,i){this.formBuilder=e,this.routesService=i,this.route=null,this.closeForm=new E,this.selectedCities=u([]),this.selectedCarriages=u([]),this.cityOptions=b(()=>this.selectedCities().map(r=>this.routesService.stationsMap()[r].connectedTo?.map(p=>this.routesService.stationsMap()[p.id])||[])),this.isSubmitDisabled=b(()=>this.selectedCities().length<qt||this.selectedCarriages().length<Ut),this.isLoading=u(!1),this.form=this.formBuilder.group({selectStation:this.formBuilder.array([this.formBuilder.control("")]),selectCarriage:this.formBuilder.array([this.formBuilder.control("")])}),$(()=>{let r=this.routesService.routes();this.route&&!r.map(p=>p.id).includes(this.route.id)&&this.closeForm.emit()})}ngOnChanges(){this.route&&(this.selectedCities.set(this.route.path),this.selectedCarriages.set(this.route.carriages),this.stationsFormArray.clear(),this.selectedCities().forEach(e=>this.stationsFormArray.push(this.formBuilder.control(e.toString()))),this.stationsFormArray.push(this.formBuilder.control("")),this.carriagesFormArray.clear(),this.selectedCarriages().forEach(e=>this.carriagesFormArray.push(this.formBuilder.control(e))),this.carriagesFormArray.push(this.formBuilder.control("")))}get stationsFormArray(){return this.form.controls.selectStation}get carriagesFormArray(){return this.form.controls.selectCarriage}addNewStation(e){if(e<this.stationsFormArray.controls.length-1)for(let i=this.stationsFormArray.length-1;i>e;i-=1)this.stationsFormArray.removeAt(i);this.stationsFormArray.push(this.formBuilder.control("")),this.selectedCities.set(this.stationsFormArray.value.slice(0,-1).map(i=>Number(i)))}addNewCarriage(e){if(e<this.carriagesFormArray.controls.length-1)for(let i=this.carriagesFormArray.length-1;i>e;i-=1)this.carriagesFormArray.removeAt(i);this.carriagesFormArray.push(this.formBuilder.control("")),this.selectedCarriages.set(this.carriagesFormArray.value.slice(0,-1))}onSubmit(){if(this.isSubmitDisabled())return;this.isLoading.set(!0);let e=this.selectedCities(),i=this.selectedCarriages();if(this.route){this.routesService.updateRoute(this.route.id,e,i).subscribe(()=>{this.isLoading.set(!1),this.closeForm.emit()});return}this.routesService.createRoute(e,i).subscribe(()=>{this.isLoading.set(!1),this.closeForm.emit()})}onCancel(){this.closeForm.emit()}};n.\u0275fac=function(i){return new(i||n)(v(pt),v(O))},n.\u0275cmp=M({type:n,selectors:[["app-create-route-form"]],inputs:{route:"route"},outputs:{closeForm:"closeForm"},standalone:!0,features:[W,R],decls:1,vars:1,consts:[[1,"form",3,"formGroup"],[1,"form",3,"ngSubmit","formGroup"],[1,"wrapper"],[1,"form-wrapper"],["formArrayName","selectStation"],["formArrayName","selectCarriage"],[1,"buttons-wrapper"],["mat-button","","type","button",1,"button",3,"click","disabled"],["diameter","40"],["mat-flat-button","","type","submit",1,"button",3,"disabled"],["appearance","outline",1,"dense-5","form-field"],[3,"selectionChange","formControlName"],[3,"value"]],template:function(i,r){i&1&&g(0,Gt,17,3,"form",0),i&2&&f(r.form?0:-1)},dependencies:[ft,gt,Mt,dt,P,w,D,N,ut,st,rt,at,ct,mt,lt],styles:["[_nghost-%COMP%]{width:100%}.form[_ngcontent-%COMP%], .form-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:start;align-items:center;width:100%}.form[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .form-wrapper[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{align-self:start}.form-wrapper[_ngcontent-%COMP%]{align-items:stretch;min-width:0}.wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:30px;width:100%;max-width:830px}@media (max-width: 560px){.wrapper[_ngcontent-%COMP%]{gap:10px}}.buttons-wrapper[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.button[_ngcontent-%COMP%]{width:auto;font-size:18px}  .mat-mdc-text-field-wrapper{background-color:var(--mdc-outlined-card-container-color)!important}.form-field[_ngcontent-%COMP%]{width:100%;height:50px}"],changeDetection:0});let t=n;return t})();var Qt=t=>["/admin/routes",t],Ht=()=>({fromRoutesPage:!0});function Wt(t,n){if(t&1&&(s(0,"strong"),l(1),a()),t&2){let o=m().$implicit;c(),z("",o,"\xA0\xA0\u0336\xA0 ")}}function Jt(t,n){if(t&1&&(s(0,"strong"),l(1),a()),t&2){let o=m().$implicit;c(),y(o)}}function Kt(t,n){if(t&1&&(s(0,"span"),g(1,Wt,2,1,"strong")(2,Jt,2,1,"strong"),a()),t&2){let o=n.$index,e=n.$count;c(),f(o!==e-1?1:2)}}function Xt(t,n){if(t&1&&(s(0,"strong"),l(1),a()),t&2){let o=m().$implicit;c(),z("",o,"\xA0\xA0\u0336\xA0 ")}}function Yt(t,n){if(t&1&&(s(0,"strong"),l(1),a()),t&2){let o=m().$implicit;c(),y(o)}}function Zt(t,n){if(t&1&&(s(0,"span"),g(1,Xt,2,1,"strong")(2,Yt,2,1,"strong"),a()),t&2){let o=n.$index,e=n.$count;c(),f(o!==e-1?1:2)}}var Et=(()=>{let n=class n{constructor(e,i){this.routesService=e,this.dialog=i,this.update=new E}openDialog(){this.dialog.open(wt,{data:{heading:"Delete ride",content:"Would you like to delete this ride?",onDelete:()=>this.routesService.deleteRoute(this.route.id)},width:"250px",enterAnimationDuration:0,exitAnimationDuration:0})}onUpdate(){this.update.emit(this.route)}};n.\u0275fac=function(i){return new(i||n)(v(O),v(yt))},n.\u0275cmp=M({type:n,selectors:[["app-route-card"]],inputs:{route:"route"},outputs:{update:"update"},standalone:!0,features:[R],decls:26,vars:6,consts:[["appearance","outlined"],[1,"buttons-wrapper"],["mat-button","",1,"card-button",3,"click"],["mat-button","","aria-label","button",1,"card-button",3,"routerLink","state"],[1,"delete-icon"]],template:function(i,r){i&1&&(s(0,"mat-card",0)(1,"mat-card-header")(2,"mat-card-title"),l(3),a(),s(4,"div",1)(5,"button",2),d("click",function(){return r.onUpdate()}),l(6," Update "),s(7,"mat-icon"),l(8,"edit"),a()(),s(9,"a",3)(10,"mat-icon"),l(11,"train"),a(),l(12," Assign\xA0ride "),a(),s(13,"button",2),d("click",function(){return r.openDialog()}),s(14,"mat-icon",4),l(15,"delete"),a()()()(),s(16,"mat-card-subtitle"),l(17,"Cities:"),a(),s(18,"mat-card-content"),h(19,Kt,3,1,"span",null,k),a(),s(21,"mat-card-subtitle"),l(22,"Carriage Types:"),a(),s(23,"mat-card-content"),h(24,Zt,3,1,"span",null,k),a()()),i&2&&(c(3),z("Route ",r.route.id,""),c(6),_("routerLink",tt(3,Qt,r.route.id))("state",Z(5,Ht)),c(10),C(r.route.cities),c(5),C(r.route.carriages))},dependencies:[xt,bt,St,vt,Ft,Ct,ht,P,_t,w,ot],styles:["[_nghost-%COMP%]{width:100%}.mat-mdc-card-content[_ngcontent-%COMP%]{padding:10px 16px}.mat-mdc-card-header[_ngcontent-%COMP%]{padding:16px;align-items:center;justify-content:space-between}.mat-mdc-card-subtitle[_ngcontent-%COMP%]{padding-left:16px}.buttons-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.card-button[_ngcontent-%COMP%]{padding:10px;border:none;background-color:inherit;font-size:16px;color:#000}.card-button[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{font-size:20px}.delete-icon[_ngcontent-%COMP%]{margin:0}@media (max-width: 570px){.mat-mdc-card-header[_ngcontent-%COMP%]{flex-direction:column;align-items:start;gap:10px}.buttons-wrapper[_ngcontent-%COMP%]{align-self:center}}@media (max-width: 450px){.mat-mdc-card-content[_ngcontent-%COMP%], .mat-mdc-card-header[_ngcontent-%COMP%]{padding:10px}.mat-mdc-card-subtitle[_ngcontent-%COMP%]{padding-left:10px}.card-button[_ngcontent-%COMP%]{font-size:14px}.card-button[_ngcontent-%COMP%] > .mat-icon[_ngcontent-%COMP%]{margin-right:4px;font-size:18px}}"],changeDetection:0});let t=n;return t})();var te=["form"],ee=(t,n)=>n.id;function ie(t,n){t&1&&I(0,"mat-spinner",2)}function ne(t,n){if(t&1){let o=F();s(0,"app-create-route-form",6,0),d("closeForm",function(){x(o);let i=m(2);return S(i.onCloseForm())}),a()}if(t&2){let o=m(2);_("route",o.selectedRoute())}}function oe(t,n){if(t&1){let o=F();s(0,"button",7),d("click",function(){x(o);let i=m(2);return S(i.showCreateForm())}),l(1,"Create"),a()}}function re(t,n){if(t&1){let o=F();s(0,"app-route-card",8),d("update",function(i){x(o);let r=m(2);return S(r.onUpdate(i))}),a()}if(t&2){let o=n.$implicit;_("route",o)}}function ae(t,n){if(t&1){let o=F();s(0,"mat-paginator",9),d("page",function(i){x(o);let r=m(2);return S(r.onPageChange(i))}),a()}if(t&2){let o=m(2);_("pageIndex",o.currentPage())("length",n)("pageSize",o.pageSize())("pageSizeOptions",o.pageSizes)}}function se(t,n){if(t&1&&(g(0,ne,2,1,"app-create-route-form",3)(1,oe,2,0,"button",4),h(2,re,1,1,"app-route-card",3,ee),g(4,ae,1,4,"mat-paginator",5)),t&2){let o,e=m();f(e.isFormOpen()?0:1),c(2),C(e.paginatorRoutes()),c(2),f((o=e.routesService.routes().length)?4:-1,o)}}var We=(()=>{let n=class n{set form(e){e&&(this.formRef=e),e&&this.selectedRoute()&&e.nativeElement.scrollIntoView(!0)}constructor(e,i,r){this.routesService=e,this.router=i,this.activatedRoute=r,this.formRef=null,this.initialPageSize=10,this.pageSizes=[5,10,15],this.currentPage=u(0),this.pageSize=u(this.initialPageSize),this.isFormOpen=u(!1),this.selectedRoute=u(null),this.paginatorRoutes=b(()=>{let p=this.currentPage()*this.pageSize(),V=p+this.pageSize();return this.routesService.routes().slice(p,V)}),$(()=>{this.paginatorRoutes().length===0&&this.currentPage()>0&&this.currentPage.update(p=>p-1)},{allowSignalWrites:!0})}ngOnInit(){let e=Number(this.activatedRoute.snapshot.queryParamMap.get("page"))||0,i=Number(this.activatedRoute.snapshot.queryParamMap.get("size"))||this.initialPageSize;this.currentPage.set(e),this.pageSize.set(i),this.activatedRoute.queryParamMap.subscribe(r=>{r.has("page")&&this.currentPage.set(Number(r.get("page"))),r.has("size")&&this.pageSize.set(Number(r.get("size")))})}onPageChange(e){this.router.navigate([],{relativeTo:this.activatedRoute,queryParams:{page:e.pageIndex,size:e.pageSize}})}showCreateForm(){this.isFormOpen.set(!0)}onCloseForm(){this.selectedRoute.set(null),this.isFormOpen.set(!1)}onUpdate(e){this.selectedRoute.set(e),this.isFormOpen.set(!0),this.formRef?.nativeElement.scrollIntoView(!0)}};n.\u0275fac=function(i){return new(i||n)(v(O),v(nt),v(it))},n.\u0275cmp=M({type:n,selectors:[["app-routes-page"]],viewQuery:function(i,r){if(i&1&&K(te,5,J),i&2){let p;X(p=Y())&&(r.form=p.first)}},standalone:!0,features:[R],decls:3,vars:1,consts:[["form",""],[1,"wrapper"],[1,"spinner"],[3,"route"],["mat-flat-button","",1,"create-button"],["showFirstLastButtons","true",1,"paginator",3,"pageIndex","length","pageSize","pageSizeOptions"],[3,"closeForm","route"],["mat-flat-button","",1,"create-button",3,"click"],[3,"update","route"],["showFirstLastButtons","true",1,"paginator",3,"page","pageIndex","length","pageSize","pageSizeOptions"]],template:function(i,r){i&1&&(s(0,"main",1),g(1,ie,1,0,"mat-spinner",2)(2,se,5,2),a()),i&2&&(c(),f(r.routesService.isLoading()?1:2))},dependencies:[Et,Rt,P,w,D,N,Tt],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:90%;max-width:1300px;margin:20px auto}.create-button[_ngcontent-%COMP%]{align-self:start;font-size:18px}.paginator[_ngcontent-%COMP%]{margin-bottom:20px;font-size:16px}@media (max-width: 450px){.paginator[_ngcontent-%COMP%]{font-size:14px}}.spinner[_ngcontent-%COMP%]{margin:50px}"],changeDetection:0});let t=n;return t})();export{We as RoutesPageComponent};
