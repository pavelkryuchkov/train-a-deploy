import{a as be}from"./chunk-DSA65HP3.js";import{c as Se}from"./chunk-H3B25AWE.js";import{c as he}from"./chunk-MY2BAZRV.js";import{a as pe,c as ue}from"./chunk-M7SACJ72.js";import{a as we}from"./chunk-GGTS4WZW.js";import{a as O,b as ve}from"./chunk-RHCQY3SH.js";import{b as W,d as oe,f as J,g as K,i as Q,j as _e,l as U,m as fe,n as X,p as Ce,q as ge,r as xe,t as Z,u as P,y as D}from"./chunk-KAAQNIV2.js";import"./chunk-KR6GTJZ6.js";import"./chunk-ICGFHLI7.js";import{d as le,h as ce,k as me}from"./chunk-3QW477QG.js";import{$b as m,Ab as p,Ac as T,Bb as H,Db as j,Eb as B,Fa as $,Fb as a,Gb as s,Hb as y,J as se,Jb as C,Ob as g,Qb as d,_ as A,a as E,ab as c,ac as Y,b as M,ba as L,bb as w,bc as k,ea as de,gc as I,ic as z,ja as ie,kc as ne,lc as re,mb as h,oa as V,t as ae,tb as x,vb as S,wa as N,xa as _,ya as f,yb as G}from"./chunk-BUUJEY2M.js";var F=(()=>{let r=class r{constructor(e,i){this.http=e,this.stationsService=i,this.baseSchedule=h(null),this.stations=this.stationsService.stations,this.stationsMap=this.stationsService.stationsMap,this.schedule=T(()=>{let o=this.baseSchedule();if(!o)return null;let l=o.schedule.map(u=>M(E({},u),{segments:u.segments.map(b=>M(E({},b),{time:b.time.map(R=>typeof R=="string"?Date.parse(R):R)}))}));return M(E({},o),{cities:o.path.map(u=>this.stationsMap()[u]?.city||""),schedule:l})}),this.isLoadingSchedule=h(!1),this.isLoadingStations=h(!1),this.isLoading=T(()=>this.isLoadingSchedule()||this.isLoadingStations()),this.loadStations()}getSchedule(e){return this.http.get(`/api/route/${e}`).pipe(se(i=>{if(i.error.reason===he.rideNotFound)return ae(null);throw i}))}loadSchedule(e){this.isLoadingSchedule.set(!0),this.getSchedule(e).subscribe(i=>{this.baseSchedule.set(i),this.isLoadingSchedule.set(!1)})}loadStations(){this.isLoadingStations.set(!0),this.http.get("/api/station").subscribe(e=>{this.stations.set(e),this.isLoadingStations.set(!1)})}changePrices(e,i,o){let l=this.baseSchedule();if(!l)throw new Error("Shedule not found");let u=l.id,b=l.schedule.find(v=>v.rideId===e);if(!b)throw new Error("Ride not found");let R=b.segments.map((v,q)=>q===i?M(E({},v),{price:o}):v);return this.http.put(`/api/route/${u}/ride/${e}`,{segments:R}).pipe(A(()=>this.getSchedule(u)),L(v=>this.baseSchedule.set(v)))}changeTime(e,i,o){let l=this.schedule();if(!l)throw new Error("Shedule not found");let u=l.id,b=l.schedule.find(v=>v.rideId===e);if(!b)throw new Error("Ride not found");let R=b.segments.map((v,q)=>q===i-1&&o.arrival!==void 0?M(E({},v),{time:[v.time[0],o.arrival]}):q===i&&o.departure!==void 0?M(E({},v),{time:[o.departure,v.time[1]]}):v);return this.http.put(`/api/route/${u}/ride/${e}`,{segments:R}).pipe(A(()=>this.getSchedule(u)),L(v=>this.baseSchedule.set(v)))}createRide(e){let i=this.schedule();if(!i)throw new Error("Shedule not found");let o=i.id;return this.http.post(`/api/route/${o}/ride`,{segments:e}).pipe(A(()=>this.getSchedule(o)),L(l=>this.baseSchedule.set(l)))}deleteRide(e){let i=this.schedule();if(!i)throw new Error("Shedule not found");let o=i.id;return this.http.delete(`/api/route/${o}/ride/${e}`).pipe(A(()=>this.getSchedule(o)),L(l=>this.baseSchedule.set(l)))}};r.\u0275fac=function(i){return new(i||r)(ie(me),ie(we))},r.\u0275prov=de({token:r,factory:r.\u0275fac,providedIn:"root"});let t=r;return t})();var Ie=t=>({"input-error":t});function Pe(t,r){if(t&1&&y(0,"input",7),t&2){let n=d().$index,e=d();G(z(3,Ie,e.showErrors()&&e.pricesFormArray.controls[n].invalid)),S("formControlName",n)}}function De(t,r){if(t&1&&(a(0,"span",6),m(1),s()),t&2){let n=d().$implicit;c(),k("$",n[1],"")}}function Oe(t,r){if(t&1&&(a(0,"p",3)(1,"span",4),m(2),s(),x(3,Pe,1,5,"input",5)(4,De,2,1,"span",6),s()),t&2){let n=r.$implicit,e=d();c(2),k("",n[0],"\xA0\u2014\xA0"),c(),p(e.isEditing()||e.createMode?3:4)}}function Fe(t,r){t&1&&(a(0,"button",8),y(1,"mat-spinner",10),s()),t&2&&S("disabled",!0)}function Re(t,r){if(t&1){let n=C();a(0,"button",11),g("click",function(){_(n);let i=d(2);return f(i.onSave())}),a(1,"mat-icon",12),m(2,"save"),s()()}}function ke(t,r){if(t&1){let n=C();a(0,"button",11),g("click",function(){_(n);let i=d(2);return f(i.onEdit())}),a(1,"mat-icon",12),m(2,"edit"),s()()}}function Ne(t,r){if(t&1&&x(0,Fe,2,1,"button",8)(1,Re,3,0,"button",9)(2,ke,3,0,"button",9),t&2){let n=d();p(n.isSaving()?0:n.isEditing()?1:2)}}var Ee=(()=>{let r=class r{constructor(e,i){this.formBuilder=e,this.scheduleService=i,this.pricesChange=new $,this.priceEntries=[],this.isEditing=h(!1),this.isSaving=h(!1),this.showErrors=h(!1),this.form=this.formBuilder.group({prices:this.formBuilder.array([])})}ngOnChanges(e){if("prices"in e){let i=e.prices.currentValue;this.priceEntries=Object.entries(i)}if("showValidationErrors"in e){let i=e.showValidationErrors.currentValue;this.showErrors.set(i)}}ngOnInit(){this.priceEntries.forEach(e=>this.form.controls.prices.push(this.formBuilder.control(e[1],[oe.required,oe.min(0)]))),this.form.valueChanges.subscribe(e=>{if(this.form.valid&&this.createMode){let i=this.priceEntries.map(([o],l)=>[o,e.prices?.[l]||0]);this.pricesChange.emit({segmentId:this.segmentId,prices:Object.fromEntries(i)})}})}get pricesFormArray(){return this.form.get("prices")}onEdit(){this.isEditing.set(!0)}onSave(){if(this.form.invalid){this.showErrors.set(!0);return}if(!this.rideId)return;let e=this.priceEntries.map((i,o)=>[i[0],this.pricesFormArray.value[o]]);this.isSaving.set(!0),this.scheduleService.changePrices(this.rideId,this.segmentId,Object.fromEntries(e)).subscribe(()=>{this.isEditing.set(!1),this.isSaving.set(!1)})}};r.\u0275fac=function(i){return new(i||r)(w(ge),w(F))},r.\u0275cmp=V({type:r,selectors:[["app-prices"]],inputs:{prices:"prices",segmentId:"segmentId",rideId:"rideId",createMode:"createMode",showValidationErrors:"showValidationErrors"},outputs:{pricesChange:"pricesChange"},standalone:!0,features:[N,I],decls:7,vars:2,consts:[[1,"form",3,"formGroup"],[1,"heading"],["formArrayName","prices"],[1,"price-wrapper"],[1,"carriage"],["type","number","min","0",1,"price-input",3,"formControlName","class"],[1,"price"],["type","number","min","0",1,"price-input",3,"formControlName"],["mat-button","",3,"disabled"],["mat-button",""],["diameter","35",1,"spinner"],["mat-button","",3,"click"],["color","primary",1,"icon"]],template:function(i,o){i&1&&(a(0,"form",0)(1,"h6",1),m(2,"Price"),s(),a(3,"div",2),j(4,Oe,5,2,"p",3,H),s()(),x(6,Ne,3,1)),i&2&&(S("formGroup",o.form),c(4),B(o.priceEntries),c(2),p(o.createMode?-1:6))},dependencies:[Z,Q,W,_e,J,K,Ce,U,X,fe,D,P,O],styles:["[_nghost-%COMP%]{display:inline-flex}.form[_ngcontent-%COMP%]{max-width:170px}.heading[_ngcontent-%COMP%], .price[_ngcontent-%COMP%]{margin:0}.price-wrapper[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr;margin-bottom:2px}.price-input[_ngcontent-%COMP%]{min-width:60px;border:1px solid #c4c6d0;outline-color:#c4c6d0}.input-error[_ngcontent-%COMP%]{border-color:#ba1a1a;outline-color:#ba1a1a}.icon[_ngcontent-%COMP%]{width:24px!important;height:24px!important;font-size:24px!important;margin:0!important}"],changeDetection:0});let t=r;return t})();var ye=t=>({"input-error":t});function $e(t,r){if(t&1&&y(0,"input",3),t&2){let n=d(2);G(z(2,ye,n.showErrors()&&n.form.controls.arrival.invalid))}}function je(t,r){if(t&1&&(a(0,"span"),m(1),ne(2,"date"),s()),t&2){let n=d(2);c(),Y(re(2,1,n.arrival,"dd/MM/YYYY hh:mm a"))}}function Be(t,r){if(t&1&&(a(0,"p",1)(1,"strong"),m(2,"Arrival: "),s(),x(3,$e,1,4,"input",2)(4,je,3,4,"span"),s()),t&2){let n=d();c(3),p(n.isEditing()||n.createMode?3:4)}}function Ae(t,r){if(t&1&&y(0,"input",5),t&2){let n=d(2);G(z(2,ye,n.showErrors()&&n.form.controls.departure.invalid))}}function Le(t,r){if(t&1&&(a(0,"span"),m(1),ne(2,"date"),s()),t&2){let n=d(2);c(),Y(re(2,1,n.departure,"dd/MM/YYYY hh:mm a"))}}function Ge(t,r){if(t&1&&(a(0,"p",1)(1,"strong"),m(2,"Departure: "),s(),x(3,Ae,1,4,"input",4)(4,Le,3,4,"span"),s()),t&2){let n=d();c(3),p(n.isEditing()||n.createMode?3:4)}}function Ye(t,r){t&1&&(a(0,"button",6),y(1,"mat-spinner",8),s()),t&2&&S("disabled",!0)}function ze(t,r){if(t&1){let n=C();a(0,"button",9),g("click",function(){_(n);let i=d(2);return f(i.onSave())}),a(1,"mat-icon",10),m(2,"save"),s()()}}function qe(t,r){if(t&1){let n=C();a(0,"button",9),g("click",function(){_(n);let i=d(2);return f(i.onEdit())}),a(1,"mat-icon",10),m(2,"edit"),s()()}}function He(t,r){if(t&1&&x(0,Ye,2,1,"button",6)(1,ze,3,0,"button",7)(2,qe,3,0,"button",7),t&2){let n=d();p(n.isSaving()?0:n.isEditing()?1:2)}}var Me=(()=>{let r=class r{constructor(e,i){this.formBuilder=e,this.scheduleService=i,this.timeChange=new $,this.isEditing=h(!1),this.isSaving=h(!1),this.showErrors=h(!1),this.form=this.formBuilder.group({arrival:"",departure:""})}ngOnChanges(e){if("arrival"in e){let i=e.arrival.currentValue,o=i!==null?this.formatDate(i):"";this.form.controls.arrival.setValue(o),this.form.controls.arrival.addValidators([this.dateValidator.bind(this)])}if("departure"in e){let i=e.departure.currentValue,o=i!==null?this.formatDate(i):"";this.form.controls.departure.setValue(o),this.form.controls.departure.addValidators([this.dateValidator.bind(this)])}if("showValidationErrors"in e){let i=e.showValidationErrors.currentValue;this.showErrors.set(i)}}ngOnInit(){this.form.valueChanges.subscribe(e=>{if(this.form.valid&&this.createMode){let i={};e.arrival&&(i.arrival=this.inputDateToTimeStamp(e.arrival)),e.departure&&(i.departure=this.inputDateToTimeStamp(e.departure)),this.timeChange.emit({segmentId:this.segmentId,time:i})}})}formatDate(e){return new Date(e).toLocaleString("en-GB",{dateStyle:"short",timeStyle:"short"})}inputDateToTimeStamp(e){let[i,o]=e.trim().split(",");if(i){let l=i.trim().split("/");if(l.length<3)return NaN;i=l.reverse().join("-")}return o&&(o=o.trim()),Date.parse(`${i}T${o||"00:00"}`)}isInputDateValid(e){let i=this.inputDateToTimeStamp(e);return!Number.isNaN(i)}dateValidator(e){let i=e.value;return this.isInputDateValid(i)?null:{invalidDate:!0}}onEdit(){this.isEditing.set(!0)}onSave(){if(this.form.invalid){this.showErrors.set(!0);return}if(!this.rideId)return;let e={};typeof this.arrival=="number"&&(e.arrival=this.inputDateToTimeStamp(this.form.controls.arrival.value)),typeof this.departure=="number"&&(e.departure=this.inputDateToTimeStamp(this.form.controls.departure.value)),this.isSaving.set(!0),this.scheduleService.changeTime(this.rideId,this.segmentId,e).subscribe(()=>{this.isEditing.set(!1),this.isSaving.set(!1)})}};r.\u0275fac=function(i){return new(i||r)(w(xe),w(F))},r.\u0275cmp=V({type:r,selectors:[["app-time"]],inputs:{segmentId:"segmentId",rideId:"rideId",arrival:"arrival",departure:"departure",createMode:"createMode",showValidationErrors:"showValidationErrors"},outputs:{timeChange:"timeChange"},standalone:!0,features:[N,I],decls:4,vars:4,consts:[[3,"formGroup"],[1,"row"],["type","text","placeholder","dd/mm/yyyy, hh:mm","formControlName","arrival",1,"input",3,"class"],["type","text","placeholder","dd/mm/yyyy, hh:mm","formControlName","arrival",1,"input"],["type","text","placeholder","dd/mm/yyyy, hh:mm","formControlName","departure",1,"input",3,"class"],["type","text","placeholder","dd/mm/yyyy, hh:mm","formControlName","departure",1,"input"],["mat-button","",3,"disabled"],["mat-button",""],["diameter","35",1,"spinner"],["mat-button","",3,"click"],["color","primary",1,"icon"]],template:function(i,o){i&1&&(a(0,"form",0),x(1,Be,5,1,"p",1)(2,Ge,5,1,"p",1),s(),x(3,He,3,1)),i&2&&(S("formGroup",o.form),c(),p(o.arrival!==void 0?1:-1),c(),p(o.departure!==void 0?2:-1),c(),p(o.createMode?-1:3))},dependencies:[Z,Q,W,J,K,U,X,ce,D,P,O],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between}.row[_ngcontent-%COMP%]{margin:0}.icon[_ngcontent-%COMP%]{width:24px!important;height:24px!important;font-size:24px!important;margin:0!important}.input[_ngcontent-%COMP%]{min-width:60px;border:1px solid #c4c6d0;outline-color:#c4c6d0}.input-error[_ngcontent-%COMP%]{border-color:#ba1a1a;outline-color:#ba1a1a}"],changeDetection:0});let t=r;return t})();function We(t,r){t&1&&(a(0,"h6",1),m(1,"New Ride"),s())}function Je(t,r){if(t&1&&(a(0,"h6",1),m(1),s()),t&2){let n=d();c(),k("Ride ",n.ride==null?null:n.ride.rideId,"")}}function Ke(t,r){t&1&&(a(0,"button",2),y(1,"mat-spinner",6),s()),t&2&&S("disabled",!0)}function Qe(t,r){if(t&1){let n=C();a(0,"button",7),g("click",function(){_(n);let i=d();return f(i.onSave())}),a(1,"mat-icon",8),m(2,"save"),s()()}}function Ue(t,r){if(t&1){let n=C();a(0,"button",7),g("click",function(){_(n);let i=d();return f(i.onDelete())}),a(1,"mat-icon",8),m(2,"delete"),s()()}}function Xe(t,r){if(t&1){let n=C();a(0,"app-time",16),g("timeChange",function(i){_(n);let o=d(2);return f(o.onTimeChange(i))}),s()}if(t&2){let n=d().$index,e=d();S("rideId",e.ride==null?null:e.ride.rideId)("segmentId",n)("departure",e.ride==null||e.ride.segments==null||e.ride.segments[0]==null||e.ride.segments[0].time==null?null:e.ride.segments[0].time[0])("createMode",e.createMode)("showValidationErrors",e.showValidationErrors())}}function Ze(t,r){if(t&1){let n=C();a(0,"app-time",17),g("timeChange",function(i){_(n);let o=d(2);return f(o.onTimeChange(i))}),s()}if(t&2){let n=d().$index,e=d();S("rideId",e.ride==null?null:e.ride.rideId)("segmentId",n)("arrival",e.ride==null||e.ride.segments==null||e.ride.segments[n-1]==null||e.ride.segments[n-1].time==null?null:e.ride.segments[n-1].time[1])("createMode",e.createMode)("showValidationErrors",e.showValidationErrors())}}function et(t,r){if(t&1){let n=C();a(0,"app-time",18),g("timeChange",function(i){_(n);let o=d(2);return f(o.onTimeChange(i))}),s()}if(t&2){let n=d().$index,e=d();S("rideId",e.ride==null?null:e.ride.rideId)("segmentId",n)("arrival",e.ride==null||e.ride.segments==null||e.ride.segments[n-1]==null||e.ride.segments[n-1].time==null?null:e.ride.segments[n-1].time[1])("departure",e.ride==null||e.ride.segments==null||e.ride.segments[n]==null||e.ride.segments[n].time==null?null:e.ride.segments[n].time[0])("createMode",e.createMode)("showValidationErrors",e.showValidationErrors())}}function tt(t,r){if(t&1){let n=C();a(0,"app-prices",19),g("pricesChange",function(i){_(n);let o=d(2);return f(o.onPricesChange(i))}),s()}if(t&2){let n=d().$index,e=d();S("rideId",e.ride==null?null:e.ride.rideId)("segmentId",n)("prices",e.ride?e.ride.segments[n].price:e.emptyPrices)("createMode",e.createMode)("showValidationErrors",e.showValidationErrors())}}function it(t,r){if(t&1&&(a(0,"div",5)(1,"div",9)(2,"strong"),m(3),s()(),a(4,"div",10),x(5,Xe,1,5,"app-time",11)(6,Ze,1,5,"app-time",12)(7,et,1,6,"app-time",13),s(),a(8,"div",14),x(9,tt,1,5,"app-prices",15),s()()),t&2){let n=r.$implicit,e=r.$index,i=r.$count;c(3),Y(n),c(2),p(e===0?5:e===i-1?6:7),c(4),p(e!==i-1?9:-1)}}var Te=(()=>{let r=class r{constructor(e,i){this.scheduleService=e,this.dialog=i,this.closeCard=new $,this.isDeletable=h(!1),this.isSaving=h(!1),this.showValidationErrors=h(!1),this.emptyPrices={},this.newCardPrices=h({}),this.newCardTime=h({}),this.isNewCardValid=T(()=>{let o=this.newCardPrices(),l=this.newCardTime();return!(Object.keys(o).length<this.cities.length-1||Object.keys(l).length<this.cities.length-1||!Object.values(l).every(u=>u.arrival&&u.departure))}),this.newCard=T(()=>{if(!this.isNewCardValid())return[];let o=this.newCardPrices(),l=this.newCardTime();return this.cities.slice(0,-1).map((u,b)=>({time:[l[b].departure,l[b].arrival],price:o[b]}))})}ngOnChanges(e){if("ride"in e&&e.ride.currentValue.segments[0].time[0]>Date.now()&&this.isDeletable.set(!0),"carriages"in e){let i=e.carriages.currentValue;this.emptyPrices=Object.fromEntries(i.map(o=>[o,null]))}}onPricesChange(e){this.newCardPrices.update(i=>M(E({},i),{[e.segmentId]:e.prices}))}onTimeChange(e){this.newCardTime.update(i=>{let{segmentId:o}=e,l=E({},i);return e.time.arrival&&(l[o-1]=M(E({},l[o-1]),{arrival:e.time.arrival})),e.time.departure&&(l[o]=M(E({},l[o]),{departure:e.time.departure})),l})}onDelete(){let e=this.ride?.rideId;e&&this.dialog.open(be,{data:{heading:"Delete ride",content:"Would you like to delete this ride?",onDelete:()=>this.scheduleService.deleteRide(e)},width:"250px",enterAnimationDuration:0,exitAnimationDuration:0})}onSave(){if(!this.isNewCardValid()){this.showValidationErrors.set(!0);return}this.isSaving.set(!0),this.scheduleService.createRide(this.newCard()).subscribe(()=>{this.isSaving.set(!1),this.closeCard.emit()})}};r.\u0275fac=function(i){return new(i||r)(w(F),w(Se))},r.\u0275cmp=V({type:r,selectors:[["app-ride-card"]],inputs:{cities:"cities",carriages:"carriages",ride:"ride",createMode:"createMode"},outputs:{closeCard:"closeCard"},standalone:!0,features:[N,I],decls:9,vars:3,consts:[[1,"header"],[1,"heading"],["mat-button","",3,"disabled"],["mat-button",""],[1,"card-table"],[1,"card-row"],["diameter","35",1,"spinner"],["mat-button","",3,"click"],["color","primary",1,"icon"],[1,"city"],[1,"time"],[3,"rideId","segmentId","departure","createMode","showValidationErrors"],[3,"rideId","segmentId","arrival","createMode","showValidationErrors"],[3,"rideId","segmentId","arrival","departure","createMode","showValidationErrors"],[1,"prices"],[3,"rideId","segmentId","prices","createMode","showValidationErrors"],[3,"timeChange","rideId","segmentId","departure","createMode","showValidationErrors"],[3,"timeChange","rideId","segmentId","arrival","createMode","showValidationErrors"],[3,"timeChange","rideId","segmentId","arrival","departure","createMode","showValidationErrors"],[3,"pricesChange","rideId","segmentId","prices","createMode","showValidationErrors"]],template:function(i,o){i&1&&(a(0,"div",0),x(1,We,2,0,"h6",1)(2,Je,2,1,"h6",1)(3,Ke,2,1,"button",2)(4,Qe,3,0,"button",3)(5,Ue,3,0,"button",3),s(),a(6,"div",4),j(7,it,10,3,"div",5,H),s()),i&2&&(c(),p(o.createMode?1:2),c(2),p(o.createMode&&o.isSaving()?3:o.createMode?4:-1),c(2),p(o.isDeletable()?5:-1),c(2),B(o.cities))},dependencies:[Ee,Me,D,P,O],styles:['[_nghost-%COMP%]{width:100%;padding-bottom:16px;border:1px solid #c4c6d0;border-radius:12px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:8px 16px;border-bottom:1px solid #c4c6d0}.heading[_ngcontent-%COMP%]{margin-bottom:0}.icon[_ngcontent-%COMP%]{width:24px!important;height:24px!important;font-size:24px!important;margin:0!important}.card-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 2fr 1fr;grid-template-areas:"city time ." "city . prices"}.city[_ngcontent-%COMP%]{grid-area:city;min-width:70px;padding:16px;background-color:#fdfbff;overflow:hidden;text-overflow:ellipsis}.time[_ngcontent-%COMP%]{grid-area:time;padding:16px}.prices[_ngcontent-%COMP%]{grid-area:prices;justify-self:end;min-width:0;padding:16px}'],changeDetection:0});let t=r;return t})();var nt=(t,r)=>r.rideId;function rt(t,r){t&1&&y(0,"mat-spinner",1)}function ot(t,r){t&1&&(a(0,"p"),m(1,"Route not found"),s())}function at(t,r){if(t&1){let n=C();a(0,"button",10),g("click",function(){_(n);let i=d(2);return f(i.onToggleCreate())}),m(1,"Create Ride"),s()}}function st(t,r){if(t&1){let n=C();a(0,"button",11),g("click",function(){_(n);let i=d(2);return f(i.onToggleCreate())}),m(1,"Cancel"),s()}}function dt(t,r){if(t&1){let n=C();a(0,"app-ride-card",12),g("closeCard",function(){_(n);let i=d(2);return f(i.onToggleCreate())}),s()}if(t&2){let n=d(2);S("createMode",!0)("cities",n.cities())("carriages",n.carriages())}}function lt(t,r){if(t&1&&y(0,"app-ride-card",9),t&2){let n=r.$implicit,e=d(2);S("ride",n)("cities",e.cities())("carriages",e.carriages())}}function ct(t,r){if(t&1){let n=C();a(0,"div",2)(1,"button",3),g("click",function(){_(n);let i=d();return f(i.onGoBack())}),a(2,"mat-icon",4),m(3,"arrow_back"),s()(),a(4,"h4",5),m(5),s()(),x(6,at,2,0,"button",6)(7,st,2,0,"button",7)(8,dt,1,3,"app-ride-card",8),j(9,lt,1,3,"app-ride-card",9,nt)}if(t&2){let n,e=d();c(5),k("Route: ",e.routeId,""),c(),p(e.showCreateCard()?7:6),c(2),p(e.showCreateCard()?8:-1),c(),B((n=e.scheduleService.schedule())==null?null:n.schedule)}}var li=(()=>{let r=class r{constructor(e,i,o,l){this.scheduleService=e,this.router=i,this.location=o,this.activatedRoute=l,this.routeId=this.activatedRoute.snapshot.params.id,this.fromRoutesPage=this.router.getCurrentNavigation()?.extras.state?.fromRoutesPage,this.cities=T(()=>{let u=this.scheduleService.schedule();return u?u.cities:[]}),this.carriages=T(()=>{let u=this.scheduleService.schedule();return u?Array.from(new Set(u.carriages)):[]}),this.showCreateCard=h(!1)}ngOnInit(){this.scheduleService.loadSchedule(this.routeId)}onGoBack(){this.fromRoutesPage?this.location.back():this.router.navigate([".."],{relativeTo:this.activatedRoute})}onToggleCreate(){this.showCreateCard.update(e=>!e)}};r.\u0275fac=function(i){return new(i||r)(w(F),w(ue),w(le),w(pe))},r.\u0275cmp=V({type:r,selectors:[["app-schedule-page"]],standalone:!0,features:[I],decls:4,vars:1,consts:[[1,"wrapper"],[1,"spinner"],[1,"header"],["mat-button","",3,"click"],[1,"icon"],[1,"heading"],["mat-flat-button","",1,"create-button"],["mat-button","",1,"create-button"],[3,"createMode","cities","carriages"],[3,"ride","cities","carriages"],["mat-flat-button","",1,"create-button",3,"click"],["mat-button","",1,"create-button",3,"click"],[3,"closeCard","createMode","cities","carriages"]],template:function(i,o){i&1&&(a(0,"main",0),x(1,rt,1,0,"mat-spinner",1)(2,ot,2,0,"p")(3,ct,11,3),s()),i&2&&(c(),p(o.scheduleService.isLoading()?1:o.scheduleService.schedule()?o.scheduleService.schedule()?3:-1:2))},dependencies:[Te,D,P,ve,O],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:20px;width:90%;max-width:1300px;margin:20px auto;padding-bottom:24px}.spinner[_ngcontent-%COMP%]{margin:50px}.header[_ngcontent-%COMP%]{display:flex;align-items:center;align-self:flex-start}.heading[_ngcontent-%COMP%]{margin-bottom:0}.icon[_ngcontent-%COMP%]{width:24px!important;height:24px!important;margin:0!important;font-size:24px!important;color:#ccc}.create-button[_ngcontent-%COMP%]{align-self:flex-start}"],changeDetection:0});let t=r;return t})();export{li as SchedulePageComponent};
