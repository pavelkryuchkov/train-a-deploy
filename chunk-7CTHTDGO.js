import{j as g}from"./chunk-IY75RYOY.js";import{Bc as h,a as u,b as d,ba as r,ea as c,ja as l,mb as o}from"./chunk-JJOTIYVZ.js";var j=(()=>{let e=class e{constructor(t){this.http=t,this.baseRoutes=o([]),this.stations=o([]),this.carriages=o([]),this.stationsMap=h(()=>{let s={};return this.stations().forEach(i=>{s[i.id]=i}),s}),this.routes=h(()=>this.baseRoutes().map(s=>d(u({},s),{cities:s.path.map(a=>this.stationsMap()[a]?.city||"")}))),this.isLoadingRoutes=o(!1),this.isLoadingStations=o(!1),this.isLoading=h(()=>this.isLoadingRoutes()||this.isLoadingStations()),this.loadData()}loadData(){this.loadRoutes(),this.loadStations(),this.loadCarriages()}loadRoutes(){this.isLoadingRoutes.set(!0),this.http.get("/api/route").subscribe(t=>{this.baseRoutes.set(t),this.isLoadingRoutes.set(!1)})}loadStations(){this.isLoadingStations.set(!0),this.http.get("/api/station").subscribe(t=>{this.stations.set(t),this.isLoadingStations.set(!1)})}loadCarriages(){this.http.get("/api/carriage").subscribe(t=>this.carriages.set(t))}deleteRoute(t){return this.http.delete(`/api/route/${t}`).pipe(r(()=>{this.baseRoutes.update(s=>s.filter(i=>i.id!==t))}))}createRoute(t,s){return this.http.post("/api/route",{path:t,carriages:s}).pipe(r(({id:i})=>{this.baseRoutes.update(a=>[...a,{id:i,path:t,carriages:s}])}))}updateRoute(t,s,i){return this.http.put(`/api/route/${t}`,{path:s,carriages:i}).pipe(r(({id:a})=>{this.baseRoutes.update(f=>f.map(p=>p.id===a?{id:a,path:s,carriages:i}:p))}))}};e.\u0275fac=function(s){return new(s||e)(l(g))},e.\u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();export{j as a};
