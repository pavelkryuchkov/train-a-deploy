import{a as U}from"./chunk-KFB3L3HK.js";import{a as he}from"./chunk-PLFLKSHQ.js";import{a as fe}from"./chunk-YP3E4DFS.js";import{a as ne,c as ae}from"./chunk-HAJTOM24.js";import{a as re,b as oe,c as se,d as de,e as ce,f as le,g as me}from"./chunk-4D7OLZBK.js";import{a as R,b as j}from"./chunk-NFDW3DZI.js";import{a as F,d as k}from"./chunk-4PPTANTY.js";import{b as N}from"./chunk-EY4EVX2V.js";import{b as ie,c as V}from"./chunk-NZ5F7AF7.js";import{b as pe,c as ge,g as ue}from"./chunk-LJH35O3J.js";import"./chunk-3X4PWRWX.js";import"./chunk-5POHLGBV.js";import"./chunk-IP76CWZZ.js";import"./chunk-Y5E3HJHA.js";import{$b as n,Cb as g,Cc as D,Fa as Z,Fb as P,Gb as A,Hb as i,Ib as a,Jb as M,Lb as ee,Ob as w,Qb as u,Qc as te,ac as f,bb as o,bc as y,cb as p,ic as b,la as Q,mc as B,nc as H,ob as S,pa as I,vb as h,xa as X,xb as x,ya as Y}from"./chunk-G6VS4OII.js";function ye(e,t){if(e&1&&(i(0,"div")(1,"span",4),n(2,"Order ID:"),a(),n(3),a()),e&2){let d=u();o(3),y(" ",d.data.orderId,"")}}function Le(e,t){if(e&1&&(i(0,"div")(1,"span",4),n(2,"Customer Name:"),a(),n(3),a()),e&2){let d=u();o(3),y(" ",d.data.userName,"")}}function Pe(e,t){e&1&&(i(0,"div",3),M(1,"mat-spinner",5),a())}var _e=(()=>{let t=class t{constructor(l){this.dialogRef=l,this.data=Q(oe),this.isLoading=S(!1)}onDelete(){this.isLoading.set(!0),this.dialogRef.disableClose=!0,this.data.onCancel().subscribe(()=>{this.dialogRef.close(),this.isLoading.set(!1)})}};t.\u0275fac=function(s){return new(s||t)(p(re))},t.\u0275cmp=I({type:t,selectors:[["app-cancel-order-dialog"]],standalone:!0,features:[b],decls:12,vars:5,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-button","","cdkFocusInitial","","color","warn",3,"click","disabled"],[1,"loading-backdrop"],[1,"label"],["diameter","70"]],template:function(s,r){s&1&&(i(0,"h2",0),n(1,"Cancel order"),a(),i(2,"mat-dialog-content"),n(3," Would you like to cancel this order? "),h(4,ye,4,1,"div")(5,Le,4,1,"div"),a(),i(6,"mat-dialog-actions")(7,"button",1),n(8,"No"),a(),i(9,"button",2),w("click",function(){return r.onDelete()}),n(10,"Cancel"),a()(),h(11,Pe,2,0,"div",3)),s&2&&(o(4),g(r.data.orderId!==void 0?4:-1),o(),g(r.data.userName!==void 0?5:-1),o(2),x("disabled",r.isLoading()),o(2),x("disabled",r.isLoading()),o(2),g(r.isLoading()?11:-1))},dependencies:[k,F,me,de,ce,le,j,R],styles:["[_nghost-%COMP%]{position:relative}.label[_ngcontent-%COMP%]{font-weight:800}"],changeDetection:0});let e=t;return e})();function Ne(e,t){if(e&1&&(i(0,"div"),n(1," User name: "),i(2,"strong"),n(3),a()()),e&2){let d=u();o(3),f(d.card.userName)}}function Fe(e,t){if(e&1){let d=ee();i(0,"div",1)(1,"button",2),w("click",function(){X(d);let s=u();return Y(s.openDialog(s.card.id))}),n(2,"Cancel Order"),a()()}}var ve=(()=>{let t=class t{constructor(l,s,r){this.ordersService=l,this.authService=s,this.dialog=r,this.orderCancelled=new Z,this.isAdmin=this.authService.isAdmin}openDialog(l){let s={onCancel:()=>this.ordersService.deleteOrder(l,this.isAdmin())};this.isAdmin()&&(s.orderId=this.card.id,s.userName=this.card.userName),this.dialog.open(_e,{data:s,width:"350px",enterAnimationDuration:0,exitAnimationDuration:0})}};t.\u0275fac=function(s){return new(s||t)(p(U),p(N),p(se))},t.\u0275cmp=I({type:t,selectors:[["app-order-card"]],inputs:{card:"card"},outputs:{orderCancelled:"orderCancelled"},standalone:!0,features:[b],decls:42,vars:17,consts:[["appearance","outlined"],[1,"actions"],["mat-flat-button","",3,"click"]],template:function(s,r){s&1&&(i(0,"mat-card",0)(1,"mat-card-content"),h(2,Ne,4,1,"div"),i(3,"div"),n(4," Start trip station: "),i(5,"strong"),n(6),a()(),i(7,"div"),n(8," Start trip time: "),i(9,"strong"),n(10),B(11,"date"),a()(),i(12,"div"),n(13," End trip station: "),i(14,"strong"),n(15),a()(),i(16,"div"),n(17," End trip time: "),i(18,"strong"),n(19),B(20,"date"),a()(),i(21,"div"),n(22," Trip duration: "),i(23,"strong"),n(24),a()(),i(25,"div"),n(26," Carriage type: "),i(27,"strong"),n(28),a()(),i(29,"div"),n(30," Car number: "),i(31,"strong"),n(32),a()(),i(33,"div"),n(34," Seat number: "),i(35,"strong"),n(36),a()(),i(37,"div"),n(38," Price: "),i(39,"strong"),n(40),a()()(),h(41,Fe,3,0,"div",1),a()),s&2&&(o(2),g(r.isAdmin()?2:-1),o(4),f(r.card.stationStart),o(4),f(H(11,11,r.card.departureDate,"MMMM dd, HH:mm")),o(5),f(r.card.stationEnd),o(4),f(H(20,14,r.card.arrivalDate,"MMMM dd, HH:mm")),o(5),f(r.card.travelTime),o(4),f(r.card.seatInfo.carriageName),o(4),f(r.card.seatInfo.carId+1),o(4),f(r.card.seatInfo.seatNumber),o(4),y("$",r.card.price,""),o(),g(r.card.status==="active"&&!r.card.past?41:-1))},dependencies:[ne,ae,k,F,te],styles:[".actions[_ngcontent-%COMP%]{padding:15px}"],changeDetection:0});let e=t;return e})();var G=(e,t)=>t.id;function ke(e,t){e&1&&(i(0,"h3"),n(1,"Orders"),a())}function Re(e,t){e&1&&(i(0,"h3"),n(1,"My orders"),a())}function je(e,t){e&1&&M(0,"mat-spinner",1)}function Ue(e,t){if(e&1&&M(0,"app-order-card",5),e&2){let d=t.$implicit;x("card",d)}}function $e(e,t){e&1&&(i(0,"h5",6),n(1,"No orders were found"),a())}function Be(e,t){if(e&1&&M(0,"app-order-card",5),e&2){let d=t.$implicit;x("card",d)}}function He(e,t){e&1&&(i(0,"h5",6),n(1,"No orders were found"),a())}function Ve(e,t){if(e&1&&(i(0,"mat-tab-group",2)(1,"mat-tab",3)(2,"div",4),P(3,Ue,1,1,"app-order-card",5,G,!1,$e,2,0,"h5",6),a()(),i(6,"mat-tab",7)(7,"div",4),P(8,Be,1,1,"app-order-card",5,G,!1,He,2,0,"h5",6),a()()()),e&2){let d=u(2);o(3),A(d.adminOrderCards()),o(5),A(d.userOrderCards())}}function Ge(e,t){if(e&1&&M(0,"app-order-card",5),e&2){let d=t.$implicit;x("card",d)}}function We(e,t){e&1&&(i(0,"h5",6),n(1,"No orders were found"),a())}function qe(e,t){if(e&1&&P(0,Ge,1,1,"app-order-card",5,G,!1,We,2,0,"h5",6),e&2){let d=u(2);A(d.orderCards())}}function ze(e,t){if(e&1&&h(0,Ve,11,2,"mat-tab-group",2)(1,qe,3,1),e&2){let d=u();g(d.isAdmin()?0:1)}}var Mt=(()=>{let t=class t{constructor(l,s,r,W){this.ordersService=l,this.stationsService=s,this.carriagesService=r,this.authService=W,this.users=S([]),this.orders=this.ordersService.orders,this.isAdmin=this.authService.isAdmin,this.carriages=this.carriagesService.carriages,this.carriagesMap=this.carriagesService.carriagesMap,this.stations=this.stationsService.stations,this.stationsMap=this.stationsService.stationsMap,this.isLoadingOrders=S(!1),this.isLoadingUsers=S(!1),this.isLoadingCarriages=S(!1),this.isLoadingStations=S(!1),this.isLoading=D(()=>this.isLoadingOrders()||this.isLoadingUsers()||this.isLoadingCarriages()||this.isLoadingStations()),this.seatsInfo=D(()=>this.orders().map(c=>{let{seatId:_}=c,E=0;for(let O=0;O<c.carriages.length;O+=1){let L=c.carriages[O],m=this.carriagesMap()[L];if(E+=(m.leftSeats+m.rightSeats)*m.rows,E>=_){let T=_-(E-(m.leftSeats+m.rightSeats)*m.rows)||_;return{carriageCode:m.code,carriageName:m.name,carId:O,seatNumber:T}}}return{carriageCode:"",carriageName:"",carId:0,seatNumber:0}})),this.orderCards=D(()=>{let C=[];return this.stations().length===0||this.carriages().length===0?C:(this.orders().forEach((c,_)=>{let E=this.stationsMap()[c.stationStart].city,O=this.stationsMap()[c.stationEnd].city,L=c.path.findIndex(v=>v===c.stationStart),m=c.path.findIndex(v=>v===c.stationEnd)-1,T=new Date(c.schedule.segments[L].time[0]),Se=T.getTime()<Date.now(),q=new Date(c.schedule.segments[m].time[1]),z=(q.getTime()-T.getTime())/1e3/60,xe=Math.floor(z/60),Me=Math.round(z%60),Oe=`${xe.toString()}h ${Me.toString().padStart(2,"0")}m`,Ie=c.schedule.segments.reduce((v,be,K)=>K<L||K>m?v:v+be.price[this.seatsInfo()[_].carriageName],0),$=this.users().find(v=>v.id===c.userId),J="";this.isAdmin()&&(J=$?.name||$?.email||""),C.push({id:c.id,userId:c.userId,userName:J,userRole:$?.role||V,stationStart:E,stationEnd:O,departureDate:T,arrivalDate:q,travelTime:Oe,price:Ie,seatInfo:this.seatsInfo()[_],status:c.status,past:Se})}),C.sort((c,_)=>c.departureDate.getTime()-_.departureDate.getTime()))}),this.adminOrderCards=D(()=>this.orderCards().filter(C=>C.userRole===ie)),this.userOrderCards=D(()=>this.orderCards().filter(C=>C.userRole===V))}ngOnInit(){this.isLoadingCarriages.set(!0),this.carriagesService.getCarriages().subscribe(()=>this.isLoadingCarriages.set(!1)),this.isLoadingStations.set(!0),this.stationsService.getStations().subscribe(()=>this.isLoadingStations.set(!1)),this.isLoadingOrders.set(!0),this.ordersService.getOrders(this.isAdmin()).subscribe(()=>this.isLoadingOrders.set(!1)),this.isAdmin()&&(this.isLoadingUsers.set(!0),this.ordersService.getUsers().subscribe(l=>{this.users.set(l),this.isLoadingUsers.set(!1)}))}};t.\u0275fac=function(s){return new(s||t)(p(U),p(fe),p(he),p(N))},t.\u0275cmp=I({type:t,selectors:[["app-orders-page"]],standalone:!0,features:[b],decls:5,vars:2,consts:[[1,"wrapper"],[1,"spinner"],["animationDuration","0ms",1,"tab-group"],["label","My orders"],[1,"tab-group__list"],[3,"card"],[1,"message"],["label","User orders"]],template:function(s,r){s&1&&(i(0,"div",0),h(1,ke,2,0,"h3")(2,Re,2,0,"h3")(3,je,1,0,"mat-spinner",1)(4,ze,2,1),a()),s&2&&(o(),g(r.isAdmin()?1:2),o(2),g(r.isLoading()?3:4))},dependencies:[ve,j,R,ue,pe,ge],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;max-width:600px;margin:0 auto;padding:40px 20px}.spinner[_ngcontent-%COMP%]{margin:50px auto}.tab-group[_ngcontent-%COMP%]{gap:20px}.tab-group__list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.message[_ngcontent-%COMP%]{margin-top:50px;text-align:center;color:#616161}"],changeDetection:0});let e=t;return e})();export{Mt as OrdersPageComponent};
