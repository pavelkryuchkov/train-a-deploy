import{a as P}from"./chunk-SG2J27ZK.js";import{a as le}from"./chunk-PLFLKSHQ.js";import{a as ce}from"./chunk-YP3E4DFS.js";import{a as Y,c as Z}from"./chunk-HAJTOM24.js";import{a as ee,b as te}from"./chunk-WCVEZFQA.js";import{a as ie,b as ne,c as ae,d as re,e as oe,f as se,g as de}from"./chunk-57V65NWP.js";import"./chunk-Z6QEANO5.js";import{a as N,d as k}from"./chunk-4PPTANTY.js";import{b as w}from"./chunk-NLOEENRT.js";import"./chunk-3UFS333W.js";import"./chunk-3X4PWRWX.js";import"./chunk-IP76CWZZ.js";import"./chunk-Y5E3HJHA.js";import{$b as t,Cb as f,Cc as B,Fa as z,Fb as J,Gb as K,Hb as e,Ib as a,Jb as y,Lb as Q,Ob as A,Qb as x,Qc as X,ac as p,bb as s,bc as E,cb as m,ic as M,la as G,mc as F,nc as L,ob as T,pa as C,vb as v,xa as W,xb as D,ya as q}from"./chunk-G6VS4OII.js";function Me(i,n){if(i&1&&(e(0,"div")(1,"span",4),t(2,"Order ID:"),a(),t(3),a()),i&2){let u=x();s(3),E(" ",u.data.orderId,"")}}function Ie(i,n){if(i&1&&(e(0,"div")(1,"span",4),t(2,"Customer Name:"),a(),t(3),a()),i&2){let u=x();s(3),E(" ",u.data.userName,"")}}function _e(i,n){i&1&&(e(0,"div",3),y(1,"mat-spinner",5),a())}var pe=(()=>{let n=class n{constructor(c){this.dialogRef=c,this.data=G(ne),this.isLoading=T(!1)}onDelete(){this.isLoading.set(!0),this.dialogRef.disableClose=!0,this.data.onCancel().subscribe(()=>{this.dialogRef.close(),this.isLoading.set(!1)})}};n.\u0275fac=function(o){return new(o||n)(m(ie))},n.\u0275cmp=C({type:n,selectors:[["app-cancel-order-dialog"]],standalone:!0,features:[M],decls:12,vars:5,consts:[["mat-dialog-title",""],["mat-button","","mat-dialog-close","",3,"disabled"],["mat-button","","cdkFocusInitial","",3,"click","disabled"],[1,"loading-backdrop"],[1,"label"],["diameter","70"]],template:function(o,r){o&1&&(e(0,"h2",0),t(1,"Cancel order"),a(),e(2,"mat-dialog-content"),t(3," Would you like to cancel this order? "),v(4,Me,4,1,"div")(5,Ie,4,1,"div"),a(),e(6,"mat-dialog-actions")(7,"button",1),t(8,"No"),a(),e(9,"button",2),A("click",function(){return r.onDelete()}),t(10,"Ok"),a()(),v(11,_e,2,0,"div",3)),o&2&&(s(4),f(r.data.orderId!==void 0?4:-1),s(),f(r.data.userName!==void 0?5:-1),s(2),D("disabled",r.isLoading()),s(2),D("disabled",r.isLoading()),s(2),f(r.isLoading()?11:-1))},dependencies:[k,N,de,re,oe,se,te,ee],styles:["[_nghost-%COMP%]{position:relative}.label[_ngcontent-%COMP%]{font-weight:800}"],changeDetection:0});let i=n;return i})();function be(i,n){if(i&1&&(e(0,"div"),t(1," User name: "),e(2,"strong"),t(3),a()()),i&2){let u=x();s(3),p(u.card.userName)}}function Oe(i,n){if(i&1){let u=Q();e(0,"div",1)(1,"button",2),A("click",function(){W(u);let o=x();return q(o.openDialog(o.card.id))}),t(2,"Cancel Order"),a()()}}var ue=(()=>{let n=class n{constructor(c,o,r){this.ordersService=c,this.authService=o,this.dialog=r,this.orderCancelled=new z,this.isAdmin=this.authService.isAdmin}openDialog(c){let o={onCancel:()=>this.ordersService.deleteOrder(c,this.isAdmin())};this.isAdmin()&&(o.orderId=this.card.id,o.userName=this.card.userName),this.dialog.open(pe,{data:o,width:"300px",enterAnimationDuration:0,exitAnimationDuration:0})}};n.\u0275fac=function(o){return new(o||n)(m(P),m(w),m(ae))},n.\u0275cmp=C({type:n,selectors:[["app-order-card"]],inputs:{card:"card"},outputs:{orderCancelled:"orderCancelled"},standalone:!0,features:[M],decls:42,vars:17,consts:[["appearance","outlined"],[1,"actions"],["mat-flat-button","",3,"click"]],template:function(o,r){o&1&&(e(0,"mat-card",0)(1,"mat-card-content"),v(2,be,4,1,"div"),e(3,"div"),t(4," Start trip station: "),e(5,"strong"),t(6),a()(),e(7,"div"),t(8," Start trip time: "),e(9,"strong"),t(10),F(11,"date"),a()(),e(12,"div"),t(13," End trip station: "),e(14,"strong"),t(15),a()(),e(16,"div"),t(17," End trip time: "),e(18,"strong"),t(19),F(20,"date"),a()(),e(21,"div"),t(22," Trip duration: "),e(23,"strong"),t(24),a()(),e(25,"div"),t(26," Carriage type: "),e(27,"strong"),t(28),a()(),e(29,"div"),t(30," Car number: "),e(31,"strong"),t(32),a()(),e(33,"div"),t(34," Seat number: "),e(35,"strong"),t(36),a()(),e(37,"div"),t(38," Price: "),e(39,"strong"),t(40),a()()(),v(41,Oe,3,0,"div",1),a()),o&2&&(s(2),f(r.isAdmin()?2:-1),s(4),p(r.card.stationStart),s(4),p(L(11,11,r.card.departureDate,"MMMM dd, HH:mm")),s(5),p(r.card.stationEnd),s(4),p(L(20,14,r.card.arrivalDate,"MMMM dd, HH:mm")),s(5),p(r.card.travelTime),s(4),p(r.card.seatInfo.carriageName),s(4),p(r.card.seatInfo.carId+1),s(4),p(r.card.seatInfo.seatNumber),s(4),E("$",r.card.price,""),s(),f(r.card.status==="active"&&!r.card.past?41:-1))},dependencies:[Y,Z,k,N,X],styles:[".actions[_ngcontent-%COMP%]{padding:15px}"],changeDetection:0});let i=n;return i})();var Te=(i,n)=>n.id;function ye(i,n){i&1&&(e(0,"h3"),t(1,"Orders"),a())}function Ae(i,n){i&1&&(e(0,"h3"),t(1,"My orders"),a())}function we(i,n){if(i&1&&y(0,"app-order-card",1),i&2){let u=n.$implicit;D("card",u)}}var nt=(()=>{let n=class n{constructor(c,o,r,H){this.ordersService=c,this.stationsService=o,this.carriagesService=r,this.authService=H,this.users=T([]),this.orders=this.ordersService.orders,this.isAdmin=this.authService.isAdmin,this.carriages=this.carriagesService.carriages,this.carriagesMap=this.carriagesService.carriagesMap,this.stations=this.stationsService.stations,this.stationsMap=this.stationsService.stationsMap,this.seatsInfo=B(()=>this.orders().map(d=>{let{seatId:h}=d,I=0;for(let S=0;S<d.carriages.length;S+=1){let O=d.carriages[S],l=this.carriagesMap()[O];if(I+=(l.leftSeats+l.rightSeats)*l.rows,I>=h){let _=h-(I-(l.leftSeats+l.rightSeats)*l.rows)||h;return{carriageCode:l.code,carriageName:l.name,carId:S,seatNumber:_}}}return{carriageCode:"",carriageName:"",carId:0,seatNumber:0}})),this.orderCard=B(()=>{let b=[];return this.stations().length===0||this.carriages().length===0?b:(this.orders().forEach((d,h)=>{let I=this.stationsMap()[d.stationStart].city,S=this.stationsMap()[d.stationEnd].city,O=d.path.findIndex(g=>g===d.stationStart),l=d.path.findIndex(g=>g===d.stationEnd)-1,_=new Date(d.schedule.segments[O].time[0]),ge=_.getTime()<Date.now(),$=new Date(d.schedule.segments[l].time[1]),R=($.getTime()-_.getTime())/1e3/60,fe=Math.floor(R/60),he=Math.round(R%60),ve=`${fe.toString()}h ${he.toString().padStart(2,"0")}m`,Se=d.schedule.segments.reduce((g,j,U)=>U<O||U>l?g:g+j.price[this.seatsInfo()[h].carriageName],0),V="";if(this.isAdmin()){let g=this.users().find(j=>j.id===d.userId);V=g?.name||g?.email||""}b.push({id:d.id,userId:d.userId,userName:V,stationStart:I,stationEnd:S,departureDate:_,arrivalDate:$,travelTime:ve,price:Se,seatInfo:this.seatsInfo()[h],status:d.status,past:ge})}),b.sort((d,h)=>d.departureDate.getTime()-h.departureDate.getTime()))})}ngOnInit(){this.carriagesService.getCarriages().subscribe(),this.stationsService.getStations().subscribe(),this.ordersService.getOrders(this.isAdmin()).subscribe(),this.isAdmin()&&this.ordersService.getUsers().subscribe(c=>this.users.set(c))}};n.\u0275fac=function(o){return new(o||n)(m(P),m(ce),m(le),m(w))},n.\u0275cmp=C({type:n,selectors:[["app-orders-page"]],standalone:!0,features:[M],decls:5,vars:1,consts:[[1,"wrapper"],[3,"card"]],template:function(o,r){o&1&&(e(0,"div",0),v(1,ye,2,0,"h3")(2,Ae,2,0,"h3"),J(3,we,1,1,"app-order-card",1,Te),a()),o&2&&(s(),f(r.isAdmin()?1:2),s(2),K(r.orderCard()))},dependencies:[ue],styles:[".wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px;max-width:600px;margin:0 auto;padding:40px 20px}"],changeDetection:0});let i=n;return i})();export{nt as OrdersPageComponent};
